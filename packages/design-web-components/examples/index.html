<!DOCTYPE html>
<html lang="it">

<head>
  <meta charset="UTF-8" />
  <title>Test Web Components</title>
  <script src="https://unpkg.com/just-validate@latest/dist/just-validate.production.min.js"></script>
  <!-- Importa lo script del tuo Web Component -->
  <!-- <script type="module" src="dist/elements.js"></script> -->
  <script type="module">
    import "./dist/elements.js";

    registerTranslation({
      $code: 'it',
      $name: 'Italiano',
      $dir: 'ltr',
      video_consent_accept: 'Accetto i cookie',
    }, {
      $code: 'en',
      $name: 'English',
      $dir: 'ltr',
      video_consent_accept: 'Accept',
    });
  </script>


   <!-- just validate - test -->
  <script>
    const getItaliaWcParentElement = (el) => {
      let current = el;
      let ret = null;
      while (current && current !== document) {
        if (current.tagName?.toLowerCase().includes('it-')) {
          // Trovato un Web Component
          ret = current;
          break;
        }
        current = current.getRootNode().host;
      }
      return ret;
    }

    window.addEventListener('DOMContentLoaded', () => {
      const form = document.querySelector('#form');
      const itInput = document.querySelectorAll('#form it-input');

      const validation = new JustValidate(form, { errorLabelCssClass: 'd-none' });

      itInput.forEach(i => {
        i.addEventListener('input-ready', ({ detail }) => {
          const input = detail.el;
          validation.addField(input, [{
            rule: 'required',
            errorMessage: 'Campo obbligatorio justvalidate',
          }])
        });
      });
      itInput.forEach(i => {
        i.addEventListener('input', ({ detail }) => {
          validation.revalidateField(detail.el); // rivalida solo questo campo quando il suo valore cambia
        });
      });

      validation.onFail((fields) => {
        // Rimuovi TUTTI i messaggi creati da JustValidate
        document.querySelectorAll('.just-validate-error-label').forEach(el => el.remove());

        // aggiorna il Web Component
        Object.keys(fields).forEach(k => {
          const f = fields[k];
          const wc = getItaliaWcParentElement(f.elem);
          if (wc) {
            wc.validationText = f.errorMessage;
          }
        });

      });

      form.addEventListener('submit', (e) => {
        console.log("submit");
        e.preventDefault();  // blocca submit nativo
        console.log(validation);
        validation.refresh(); // resetta lo stato di validazione
        validation.validate(); // riesegue la validazione
      });

      validation.onSuccess(() => {
        console.log("onsuccess");
        itInput.forEach(i => {
          // eslint-disable-next-line no-param-reassign
          i.validationText = undefined;
        });
        //gestire qui il submit della form
        // fetch('/submit', { method: 'POST', body: ... })
      })
    });

  </script>

  <!-- <link rel="stylesheet" href="../node_modules/bootstrap-italia/dist/css/bootstrap-italia.min.css" /> -->
  <link rel="stylesheet" href="dist/design-web-components.css" />
</head>

<body>
  <!-- Usa il tuo Web Component -->
  <!-- ?outline="${params.outline}"
        ?block="${params.block}"
        ?disabled="${params.disabled}"
        type="${params.type}" -->
  <main>


    <div class="container my-5">
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore
        magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
        consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla
        pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est
        laborum.</p>
      <section>
        <<<<<<< HEAD=======<h2>it-video</h2>
          <it-video src="https://vjs.zencdn.net/v/oceans.webm"></it-video>
          <h3>Youtube:</h3>
          <it-video src="https://youtu.be/_0j7ZQ67KtY"></it-video>
      </section>
      <section>
        >>>>>>> main
        <h2>it-button</h2>
        <it-button variant="success" size="lg" icon>
          <it-icon name="it-star-full" color="white"></it-icon> <span>Pulsante con icona</span>
        </it-button>
      </section>

      <section class="mb-5">
        <h2>it-chip</h2>
        <div class="d-flex align-items-center gap-4">
          <it-chip label="Chip con icona" dismissable variant="primary" size="lg">
            <it-icon name="it-star-full" color="primary" slot="icon" size="sm"></it-icon>
            <it-button slot="dismiss-button" aria-label="Dismissable">
              <it-icon name="it-close" color="primary" size="sm"></it-icon></it-icon>
            </it-button>
          </it-chip>
          <it-chip label="Chip con avatar" avatar="https://randomuser.me/api/portraits/women/44.jpg" variant="primary"
            size="lg"></it-chip>
          <it-chip label="Disabilitato" variant="primary" size="lg" disabled></it-chip>
        </div>
      </section>

      <section>
        <h2>it-icon</h2>
        <it-icon name="it-star-full" color="primary" size="xl" label="stella"></it-icon>
      </section>

      <section>
        <h2>it-input</h2>
        <h3>Input con validazione di default del browser e del componente it-input:</h3>
        <it-input id="email_default" label="E-mail" type="email" support-text="Inserisci la tua email"></it-input>
        <br /><br />
        <h3>Input in una form con validazione esterna (tramite plugin JustValidate)</h3>
        <form id="form">
          <it-input id="email" label="E-mail" type="email" support-text="Inserisci la tua email"
            custom-validation></it-input>
          <!-- <it-input id="password"  label="Password" type="password" minlength="10" suggestions strength-meter></it-input> -->
          <input type="submit" />
        </form>
      </section>

      <section>
        <h2>it-video</h2>
        <it-video src="https://vjs.zencdn.net/v/oceans.webm"></it-video>
      </section>
    </div>
  </main>
</body>

</html>
